{"version":3,"file":"trackReorderDrag.js","sources":["src/js/utils/throttle.js","src/js/utils/trackReorderDrag.js"],"sourcesContent":["\n/**\n * @function throttle\n * @param  {integer}   FuncDelay\n * @param  {Function} callback\n * @return {Function}                  the throttled function\n */\nexport default function throttle(FuncDelay, callback) {\n  let lastCall = +new Date();\n  const delay = FuncDelay;\n  let params;\n  const context = {};\n  let calledDuringDelay = false;\n\n  return (...args) => {\n    const now = +new Date();\n    const diff = now - lastCall;\n    let timeToEndOfDelay;\n\n    params = args;\n\n    if (diff > delay) {\n      callback.apply(context, params); // Call function with latest parameters\n      calledDuringDelay = false;\n      lastCall = now;\n    } else if (!calledDuringDelay) {\n      // If it wasn't called yet, call it when there is enough delay.\n      timeToEndOfDelay = delay - diff;\n\n      setTimeout(() => {\n        callback.apply(context, params); // Call function with latest parameters\n      }, timeToEndOfDelay);\n\n      calledDuringDelay = true;\n      lastCall = now + timeToEndOfDelay;\n    } // Otherwise do nothing.\n  };\n}\n","import throttle from './throttle';\n/**\n * Will take care of the dragging and reordering a list for one drag.\n * @function trackReorderDrag\n * @param  {event} paramE        The dragstart event, from which this should be called.\n * @param  {HTMLElement} paramEl       The main Element being dragged\n * @param  {Array<HTMLElement>} paramElements Array of elements to be tracked.\n * @return {void}\n */\nexport default function trackReorderDrag(paramE, paramEl, paramElements) {\n  function setTranslation(el, val) {\n    el.style.transform = `translate3d(0, ${val}px, 0)`; //  eslint-disable-line no-param-reassign\n  }\n\n  /**\n   * @function resetElementsPositions\n   * @param {Array<HTMLElement>} els Elements being tracked\n   */\n  function resetElementsPositions(els) {\n    els.forEach((el) => {\n      setTranslation(el, 0);\n    });\n  }\n\n  /**\n   * @function calculateElementHeight\n   * @param  {Array<HTMLElement>} els    Elements ordered by vertical position\n   * @param  {Integer} elIndex\n   * @return {void}\n   */\n  function calculateElementHeight(els, elIndex) {\n    let spaceOccupied;\n\n    // If not the last element\n    if (elIndex < els.length - 1) {\n      const elTop = els[elIndex].getBoundingClientRect().top;\n      const nextElTop = els[elIndex + 1].getBoundingClientRect().top;\n      spaceOccupied = nextElTop - elTop;\n    } else {\n      // let's estimate the general vertical distance between elements by\n      // subtracting the size of the first element from the distance between\n      // its top and the next element.\n      const firstElSpaceOccupied =\n          els[1].getBoundingClientRect().top - els[0].getBoundingClientRect().top;\n      const verticalDistance = firstElSpaceOccupied - els[0].clientHeight;\n      const height = els[elIndex].clientHeight;\n      spaceOccupied = height + verticalDistance;\n    }\n\n    return spaceOccupied;\n  }\n\n  /**\n   * @function createDragMover\n   * @param  {Array<HTMLElement>} els\n   * @param  {Array<Integer>} tops        Initial tops\n   * @param  {Integer} targetIndex Index of element being dragged around\n   * @return {function}             The function to translate elements in the\n   *                                  list to make room for the dragged element\n   */\n  function createDragMover(els, tops, targetIndex) {\n    const target = els[targetIndex];\n    const targetInitialTop = tops[targetIndex];\n    const targetHeight = calculateElementHeight(els, targetIndex);\n    return function doDragMove() {\n      const targetTop = target.getBoundingClientRect().top;\n      const movedUp = (targetTop < targetInitialTop);\n\n      let i;\n      for (i = 0; i < tops.length; i++) {\n        if (i === targetIndex) {\n          continue;\n        } else\n        if (!movedUp && targetTop > tops[i] && tops[i] > targetInitialTop) {\n          setTranslation(els[i], -targetHeight);\n        } else if (movedUp && targetTop < tops[i + 1] && tops[i] < targetInitialTop) {\n          setTranslation(els[i], targetHeight);\n        } else {\n          setTranslation(els[i], 0);\n        }\n      }\n    };\n  }\n\n  function createDragListener(els, tops, targetIndex, initialY) {\n    const target = els[targetIndex];\n    const doDragMove = createDragMover(els, tops, targetIndex);\n    let shouldStopListening;\n    function dragListener(e) {\n      if (shouldStopListening) { return; }\n\n      doDragMove();\n      const newY = e.pageY;\n      if (newY === 0) { return; } // correct weird behaviour when mouse goes up\n\n      const diff = newY - initialY;\n      setTranslation(target, diff);\n    }\n\n    dragListener.stop = () => {\n      shouldStopListening = true;\n    };\n\n    return dragListener;\n  }\n\n  function getElementsCurrentTop(els) {\n    const tops = [];\n    els.forEach((el) => { tops.push(el.getBoundingClientRect().top); });\n\n    return tops;\n  }\n\n  // function adjustElementsToTops(els, tops) {\n  //   const currentTops = getElementsCurrentTop(els);\n  //   els.forEach(function (el, i) {\n  //     const diff =  currentTops[i] - tops[i];\n  //     setTranslation(el, diff);\n  //   });\n  // }\n\n  function insertTargetInRightPlace(els, initialTops, targetIndex) {\n    const target = els[targetIndex];\n    const topsBeforeInsertion = getElementsCurrentTop(els);\n    const targetTop = topsBeforeInsertion[targetIndex];\n    let i = 0;\n\n    // Pass by all elements that are above the target\n    while ((topsBeforeInsertion[i] && topsBeforeInsertion[i] < targetTop) ||\n              (i === targetIndex)) {\n      i++;\n    }\n\n    // Take away transitions from all elements and save them\n    const initialTransitions = [];\n    els.forEach((anEl) => {\n      initialTransitions.push(anEl.style.transition);\n      anEl.style.transition = 'none'; // eslint-disable-line no-param-reassign\n    });\n\n    // Put everyone at translate3d(0,0,0) without transitions\n    resetElementsPositions(els);\n\n    // Add the element in the appropriate place. This will displace everyone else.\n    const parent = (els[i]) ? els[i].parentElement : els[els.length - 1].parentElement;\n    if (!parent || !parent.appendChild) {\n      throw new Error('trackReorderDrag(): No parent found in element list.');\n    } else if (els[i]) {\n      parent.insertBefore(target, els[i]);\n    } else {\n      const lastEl = els[els.length - 1];\n      parent.insertBefore(target, lastEl);\n      parent.insertBefore(lastEl, target);\n    }\n\n    // Now let's translate it to where it was just before it was repositioned\n    // All without transitions. It will seem like it never left that spot.\n    const futureTop = target.getBoundingClientRect().top;\n    const displacement = targetTop - futureTop;\n    setTranslation(target, displacement);\n\n    // Let's add a timeout to get the last place in the UI queue and let the\n    // CSS renderer to process the fact that all these elements do not have\n    // transitions and should appear wherever their coordinates say immediately.\n    setTimeout(() => {\n      // Restore all transitions\n      els.forEach((anEl, k) => {\n        anEl.style.transition = initialTransitions[k]; // eslint-disable-line no-param-reassign\n      });\n\n      // Now transition the target can transition smoothly from where it\n      // was dropped to its final position at translate value 0.\n      setTranslation(target, 0);\n    }, 15);\n\n    //  adjustElementsToTops(els, topsBeforeInsertion);\n  }\n\n  function init(e, el, elements) {\n    if (typeof el !== 'object') {\n      throw new Error('trackReorderDrag(): Invalid parameter');\n    }\n\n    // Reorder elements\n    elements.sort((el1, el2) => {\n      return el1.getBoundingClientRect().top > el2.getBoundingClientRect().top;\n    });\n\n    // Set initial states\n    const initialTops = [];\n    elements.forEach((element) => {\n      initialTops.push(element.getBoundingClientRect().top);\n    });\n\n    const elIndex = elements.indexOf(el);\n\n    // Create throttled drag listener\n    const initialY = e.pageY;\n    const dragListener = createDragListener(elements, initialTops, elIndex, initialY);\n    const throttledDragListener = throttle(50, dragListener);\n\n    // Listen to drags\n    const eventTarget = e.target;\n    eventTarget.addEventListener('drag', throttledDragListener);\n    eventTarget.addEventListener('dragend', function dragEndListener() {\n      dragListener.stop();\n      insertTargetInRightPlace(elements, initialTops, elIndex);\n      eventTarget.removeEventListener('drag', throttledDragListener);\n      eventTarget.removeEventListener('dragend', dragEndListener);\n    });\n  }\n\n  init(paramE, paramEl, paramElements);\n}\n"],"names":["throttle","FuncDelay","callback","lastCall","Date","delay","params","context","calledDuringDelay","args","now","diff","timeToEndOfDelay","apply","trackReorderDrag","paramE","paramEl","paramElements","setTranslation","el","val","style","transform","resetElementsPositions","els","forEach","calculateElementHeight","elIndex","spaceOccupied","length","elTop","getBoundingClientRect","top","nextElTop","firstElSpaceOccupied","verticalDistance","clientHeight","height","createDragMover","tops","targetIndex","target","targetInitialTop","targetHeight","doDragMove","targetTop","movedUp","i","createDragListener","initialY","shouldStopListening","dragListener","e","newY","pageY","stop","getElementsCurrentTop","push","insertTargetInRightPlace","initialTops","topsBeforeInsertion","initialTransitions","anEl","transition","parent","parentElement","appendChild","Error","insertBefore","lastEl","futureTop","displacement","k","init","elements","sort","el1","el2","element","indexOf","throttledDragListener","eventTarget","addEventListener","dragEndListener","removeEventListener"],"mappings":"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","sourceRoot":"/source/"}
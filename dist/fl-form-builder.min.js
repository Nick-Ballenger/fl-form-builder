xController(function(a){"use strict";function b(){function a(){var a=d.querySelectorAll(".fl-component");return[].slice.call(a)}function c(b){var c=b.element.querySelector(".fl-component-side-control");if(!c)throw new Error("FormBody.addReorderButton(): No side control bar defined");var d=document.createElement("i");d.classList.add("glyphicon"),d.classList.add("glyphicon-menu-hamburger"),d.setAttribute("draggable",!0),d.addEventListener("dragstart",function(c){c.dataTransfer.setDragImage(document.createElement("img"),0,0),b.element.classList.add("fl-dragging");var d=a();j.trackReorderDrag(c,b.element,d)});var e=50;d.addEventListener("dragend",function(){setTimeout(function(){b.element.classList.remove("fl-dragging")},e+200)}),c.children.length>0?c.insertBefore(d,c.children[0]):c.appendChild(d)}if(!(this instanceof b))return new b;var d,e,f=[];this.addComponent=function(a){return d?a?(c(a),f.push(a),d.insertBefore(a.element,e),a.configToggle(!0),void 0):void console.error("FormBody: No element to be added included."):void console.error("FormBody: Form not initialised.")},this.init=function(){d=document.createElement("form"),d.classList.add("form-horizontal"),d.classList.add("fl-form-body"),d.addEventListener("submit",function(a){a.preventDefault(),console.log("Submit button clicked."),f.sort(function(a,b){return a.element.getBoundingClientRect().top>b.element.getBoundingClientRect().top});var b=JSON.stringify(f);console.dir(JSON.parse(b))});var a=this;d.addEventListener("newElement",function(b){return b.detail?void a.addComponent(b.detail.comp):void console.error('No data in "newElement" event.')}),e=document.createElement("input"),e.setAttribute("type","submit"),e.classList.add("btn"),e.classList.add("col-sm-12"),d.appendChild(e),this.element=d},this.init()}function c(){return this instanceof c?void 0:new c}function d(a){function b(a,b){var c="Temp name"+Math.floor(1e3*Math.random()),d=new a(c),e=new CustomEvent("newElement",{detail:{comp:d},bubbles:!0,cancelable:!0});b.dispatchEvent(e)}function c(){var c=document.createDocumentFragment();return j.forEach(function(d,e){var f=document.createElement("button");f.setAttribute("value",e),f.className=d["class"],f.name=d.desc,f.classList.add("btn"),f.classList.add("btn-default"),f.addEventListener("click",function(){var c=f.value;b(j[c].constr,a)}),c.appendChild(f)}),c}if(!(this instanceof d))return new d;var j=[{desc:"Radio buttons",constr:g,"class":"glyphicon glyphicon-ok-circle"},{desc:"Checkboxes",constr:e,"class":"glyphicon glyphicon-check"},{desc:"Dropdown",constr:f,"class":"glyphicon glyphicon-collapse-down"},{desc:"Text box",constr:i,"class":"glyphicon glyphicon-text-width"},{desc:"Text area",constr:h,"class":"glyphicon glyphicon-text-height"}];this.init=function(){this.element=document.createElement("div"),this.element.classList.add("fl-form-fabric");var a=c();this.element.appendChild(a)},this.init(a)}function e(a){return this instanceof e?void this.init(a):new e}function f(a){return this instanceof f?void this.init(a):new f}function g(a){return this instanceof g?void this.init(a):new g}function h(a){return this instanceof h?void this.init(a):new h}function i(a){return this instanceof i?void this.init(a):new i}var j={};j.blinkRed=function(a){a&&a.classList&&(a.classList.add("fl-blink-red"),setTimeout(function(){a.classList.remove("fl-blink-red")},1500))},j.trackReorderDrag=function(a,b,c){function d(a,b){a.style.transform="translate3d(0, "+b+"px, 0)"}function e(a){a.forEach(function(a){d(a,0)})}function f(a,b){var c;if(b<a.length-1){var d=a[b].getBoundingClientRect().top,e=a[b+1].getBoundingClientRect().top;c=e-d}else{var f=a[1].getBoundingClientRect().top-a[0].getBoundingClientRect().top,g=f-a[0].clientHeight,h=a[b].clientHeight;c=h+g}return c}function g(a,b,c){var e=a[c],g=b[c],h=f(a,c);return function(){var f,i=e.getBoundingClientRect().top,j=g>i;for(f=0;f<b.length;f++)f!==c&&(!j&&i>b[f]&&b[f]>g?d(a[f],-h):j&&i<b[f+1]&&b[f]<g?d(a[f],h):d(a[f],0))}}function h(a,b,c,e){function f(a){if(!h){j();var b=a.pageY;if(0!==b){var c=b-e;d(i,c)}}}var h,i=a[c],j=(i.getBoundingClientRect().top,g(a,b,c));return f.stop=function(){h=!0},f}function i(a){var b=[];return a.forEach(function(a){b.push(a.getBoundingClientRect().top)}),b}function k(a,b,c){for(var f=a[c],g=i(a),h=g[c],j=0;g[j]&&g[j]<h||j===c;)j++;var k=[];a.forEach(function(a){k.push(a.style.transition),a.style.transition="none"}),e(a);var l;if(l=a[j]?a[j].parentElement:a[a.length-1].parentElement,!l||!l.appendChild)throw new Error("trackReorderDrag(): No parent found in element list.");if(a[j])l.insertBefore(f,a[j]);else{var m=a[a.length-1];l.insertBefore(f,m),l.insertBefore(m,f)}var n=f.getBoundingClientRect().top,o=h-n;d(f,o),setTimeout(function(){a.forEach(function(a,b){a.style.transition=k[b]}),d(f,0)},15)}function l(a,b,c){if("object"!=typeof b)throw new Error("trackReorderDrag(): Invalid parameter");c.sort(function(a,b){return a.getBoundingClientRect().top>b.getBoundingClientRect().top});var d=[];c.forEach(function(a){d.push(a.getBoundingClientRect().top)});var e=c.indexOf(b),f=(d[e],a.pageY),g=h(c,d,e,f),i=j.throttle(50,g),l=a.target;l.addEventListener("drag",i),l.addEventListener("dragend",function m(){g.stop(),k(c,d,e),l.removeEventListener("drag",i),l.removeEventListener("dragend",m)})}l(a,b,c)},j.throttle=function(a,b){var c,d=+new Date,e=a,f={},g=!1;return function(){var a,h=+new Date,i=h-d;c=arguments,i>e?(b.apply(f,c),g=!1,d=h):g||(a=e-i,setTimeout(function(){b.apply(f,c)},a),g=!0,d=h+a)}},c.prototype.init=function(a){if("string"!=typeof a)throw new Error("FormComponent: "+a+' is not a valid "name" parameter.');this.element=document.createElement("div"),this.element.classList.add("fl-component"),this.element.classList.add("col-md-12"),this.element.classList.add("form-group"),this.content=document.createElement("div"),this.content.classList.add("fl-form-content"),this.element.appendChild(this.content);var b=document.createElement("h3");b.innerText="Add a title",b.classList.add("fl-editable"),this.title=b,this.content.appendChild(b),this.name=a,this.isRequired=!1,this.createControls()},c.prototype.createControls=function(){var a=document.createElement("div");a.classList.add("fl-component-side-control");var b=document.createElement("button");b.setAttribute("type","button"),b.classList.add("glyphicon"),b.classList.add("glyphicon-cog"),a.appendChild(b);var c=this;b.addEventListener("click",function(){c.configToggle()});var d=document.createElement("div");d.classList.add("fl-component-config"),this.configBox=d;var e=document.createElement("div");e.classList.add("full-width"),this.configContent=e,d.appendChild(e);var f=document.createElement("div");f.classList.add("col-sm-12");var g=document.createElement("button");g.setAttribute("type","button"),g.classList.add("btn"),g.classList.add("btn-danger"),g.classList.add("btn-sm"),g.classList.add("fl-bottom-btn"),g.classList.add("glyphicon"),g.classList.add("glyphicon-trash"),g.addEventListener("click",function(){c.destroy()}),f.appendChild(g);var h=document.createElement("button");h.setAttribute("type","button"),h.classList.add("btn"),h.classList.add("btn-default"),h.classList.add("btn-sm"),h.classList.add("fl-bottom-btn"),h.classList.add("glyphicon"),h.classList.add("glyphicon-ok"),h.addEventListener("click",function(){c.saveConfig(),c.configToggle()}),f.appendChild(h);var i=document.createElement("label");i.innerText="Required";var j=document.createElement("div");j.classList.add("switch");var k=document.createElement("input");k.classList.add("cmn-toggle"),k.classList.add("cmn-toggle-round"),k.setAttribute("type","checkbox"),k.id="cmn-toggle-"+Date.now(),k.addEventListener("change",function(a){var b=a.target.checked;c.required(b)}),this.requiredSwitch=k,j.appendChild(k);var l=document.createElement("label");l.setAttribute("for",k.id),j.appendChild(l),i.appendChild(j),f.appendChild(i),d.appendChild(f),this.element.appendChild(d),this.element.appendChild(a)},c.prototype.configToggle=function(a){a=a||!this.configShowing,a?this.showConfig():this.hideConfig()},c.prototype.hideConfig=function(){if(!this.configBox)throw new Error("FormComponent.configToggle(): No configBox initialised");if(this.configShowing){this.element.classList.remove("fl-form-config-visible"),this.configShowing=!1;var a=this.element.querySelectorAll(".fl-editable"),b="Set a placeholder text.";[].forEach.call(a,function(a){if(a.setAttribute("contenteditable",!1),"TEXTAREA"===a.nodeName||"INPUT"===a.nodeName&&"text"===a.type){var c=a.getAttribute("placeholder"),d=a.value;d?a.setAttribute("placeholder",d):c===b&&a.removeAttribute("placeholder"),a.value=""}})}},c.prototype.showConfig=function(){if(!this.configBox)throw new Error("FormComponent.showConfing(): No configBox initialised");if(!this.configShowing){this.element.classList.add("fl-form-config-visible"),this.configShowing=!0;var a=this.element.querySelectorAll(".fl-editable"),b="Set a placeholder text.";[].forEach.call(a,function(a){if(a.setAttribute("contenteditable",!0),"TEXTAREA"===a.nodeName||"INPUT"===a.nodeName&&"text"===a.type){var c=a.getAttribute("placeholder"),d=c?c:b;a.setAttribute("placeholder",d),a.value=""}});var c=this.focusElement||this.configBox.querySelector("switch");c&&setTimeout(function(){c.focus()},15);var d=this,e=document.body,f=!0;e.addEventListener("mousedown",function g(a){var b=g,c=a.clientX,h=a.clientY;d.isAtPoint(c,h)||(e.removeEventListener("mousedown",b,f),d.hideConfig())},f)}},c.prototype.isAtPoint=function(a,b){var c=this.configBox.getBoundingClientRect(),d=this.element.getBoundingClientRect(),e=d.top,f=c.bottom,g=Math.max(c.right,d.right),h=Math.min(c.left,d.left);return!(h>a||a>g||e>b||b>f)},c.prototype.createConfigInputField=function(a){var b=document.createElement("input");b.setAttribute("placeholder",a||"Type a new option"),b.setAttribute("type","text"),this.focusElement=b;var c=document.createElement("i");c.classList.add("glyphicon"),c.classList.add("glyphicon-plus-sign"),c.classList.add("fl-grey-btn");var d=this;c.addEventListener("click",function(){return b.value.trim()?(d.add(b.value),void(b.value="")):void j.blinkRed(b)}),b.addEventListener("keypress",function(a){if(13===a.which){var b=new Event("click");return c.dispatchEvent(b),a.preventDefault(),!1}return!0}),this.configContent.appendChild(c),this.configContent.appendChild(b)},c.prototype.saveConfig=function(){},c.prototype.destroy=function(){this.element.remove()},c.prototype.required=function(a){if(this.isRequired===a)return!0;var b=this.content.querySelectorAll("input"),c=this.content.querySelectorAll("textarea");b=[].slice.call(b),c=[].slice.call(c);var d=[].concat.call(b,c);return a?d.forEach(function(a){a.setAttribute("required",!0)}):d.forEach(function(a){a.removeAttribute("required")}),this.isRequired=a,!0},c.prototype.addPlaceHolder=function(){this.placeHolder=this.add("placeholder","Insert an option"),this.placeHolder.setAttribute("disabled",!0)},c.prototype.removePlaceHolder=function(){this.placeHolder.remove(),this.placeHolder=null},c.prototype.getElements=function(){var a=this.content.querySelectorAll(".fl-editable"),b=[];return[].forEach.call(a,function(a){"H3"!==a.nodeName&&b.push(a)}),b},c.prototype.toJSON=function(){var a={};this.title&&this.title.innerText&&(a.title=this.title.innerText),a.componentType=this.componentType,a.required=this.isRequired||!1,a.content=[];var b=this.getElements();return b=[].slice.call(b),b.forEach(function(b){var c={};c.nodeName=b.nodeName.toLowerCase(),c.type=b.getAttribute("type")||void 0,c.name=b.getAttribute("name")||void 0,c.placeholder=b.getAttribute("placeholder")||void 0,c.label=b.innerText,a.content.push(c)}),a},e.prototype=new c,e.prototype.componentType="Checkboxes",e.prototype.init=function(a){this.constructor.prototype.init.call(this,a),this.name=a+"[]",this.addPlaceHolder()},e.prototype.add=function(a,b){if(!a)throw new Error("Checkboxes.add(): No value parameter provided.");this.placeHolder&&this.removePlaceHolder(),this.isRequired&&this.getElements().length>0&&this.required(!1);var c=document.createElement("input");c.setAttribute("type","checkbox"),c.setAttribute("name",this.name),c.setAttribute("value",a),c.classList.add("fl-check-box"),this.isRequired&&c.setAttribute("required",!0);var d=document.createElement("span");d.innerText=b||a,d.classList.add("fl-editable"),d.setAttribute("contenteditable",!0);var e=document.createElement("label");return e.appendChild(c),e.appendChild(d),this.content.appendChild(e),e},e.prototype.getElements=function(){var a=this.content.children,b=[];return[].forEach.call(a,function(a){"H3"!==a.nodeName&&b.push(a)}),b},e.prototype.required=function(a){if(this.isRequired===a)return!0;if(!this.requiredSwitch)throw new Error("Checkboxes.required(): No required button in place.");if(this.getElements().length>1&&a)return console.error('Checkboxes: To be "required" there can only be one checkbox in the group.'),this.requiredSwitch.checked=!1,!1;this.isRequired=a;var b=this.content.querySelectorAll("input");return a?[].forEach.call(b,function(a){a.setAttribute("required",!0)}):[].forEach.call(b,function(a){a.removeAttribute("required")}),this.requiredSwitch.checked=a,!0},e.prototype.addPlaceHolder=function(){this.placeHolder=this.add("placeholder","Check a box")},e.prototype.createControls=function(){this.constructor.prototype.createControls.call(this);var a=document.createElement("i");a.classList.add("glyphicon"),a.classList.add("glyphicon-minus-sign"),a.classList.add("fl-grey-btn"),a.setAttribute("alt","Remove one of the checkboxes");var b=this;a.addEventListener("click",function(){var a=b.getElements(),c=a.length>0;if(!c||b.placeHolder)return void j.blinkRed(b.content);var d=a.pop();d.remove()}),this.configContent.appendChild(a),this.createConfigInputField()},f.prototype=new c,f.prototype.componentType="Dropdown",f.prototype.init=function(a){this.constructor.prototype.init.call(this,a);var b=document.createElement("div");b.classList.add("full-width"),this.selector=document.createElement("select"),this.selector.setAttribute("name",a),this.selector.classList.add("fl-dropdown"),this.selector.classList.add("form-control"),b.appendChild(this.selector),this.content.appendChild(b),this.addPlaceHolder()},f.prototype.add=function(a,b){if(!a)throw new Error("Dropdown.add(): "+a+' is not a valid "value" value.');this.placeHolder&&this.removePlaceHolder();var c=document.createElement("option");return c.innerText=b||a,this.selector.appendChild(c),c},f.prototype.addPlaceHolder=function(){this.placeHolder=this.add("placeholder","Select an option"),this.placeHolder.setAttribute("disabled",!0),this.placeHolder.setAttribute("selected",!0)},f.prototype.hideConfig=function(){return this.constructor.prototype.hideConfig.call(this),this.selector?void this.selector.removeAttribute("multiple"):void console.error("Dropdown.hideConfig(): Selector not specified")},f.prototype.showConfig=function(){return this.constructor.prototype.showConfig.call(this),this.selector?void this.selector.setAttribute("multiple",!0):void console.error("Dropdown.showConfig(): Selector not specified")},f.prototype.createControls=function(){this.constructor.prototype.createControls.call(this);var a=document.createElement("i");a.classList.add("glyphicon"),a.classList.add("glyphicon-minus-sign"),a.classList.add("fl-grey-btn"),a.setAttribute("alt","Remove one of the dropdown options");var b=this;a.addEventListener("click",function(){var a=b.selector.selectedIndex>=0;if(!a||b.placeHolder)return void j.blinkRed(b.selector);var c=b.selector.selectedIndex,d=b.selector.children[c];d.remove()}),this.configContent.appendChild(a),this.createConfigInputField()},f.prototype.getElements=function(){return[this.selector]},f.prototype.toJSON=function(){var a=this.constructor.prototype.toJSON.call(this);a.multiple=this.selector.getAttribute("multiple")||void 0,a.content=[];var b=this.content.querySelectorAll("option");return[].forEach.call(b,function(b){var c={};c.nodeName="option",c.value=b.innerText,a.content.push(c)}),a},g.prototype=new c,g.prototype.componentType="RadioBtns",g.prototype.init=function(a){this.constructor.prototype.init.call(this,a),this.createConfigInputField(),this.addPlaceHolder()},g.prototype.add=function(a,b){if(!a)throw new Error("RadioBtns.add(): "+a+' is not a valid "value" parameter');this.placeHolder&&this.removePlaceHolder();var c=document.createElement("input");c.setAttribute("type","radio"),c.setAttribute("name",this.name),c.setAttribute("value",a),c.classList.add("fl-radio-btn");var d=document.createElement("label"),e=document.createElement("span");return e.innerText=b||a,e.classList.add("fl-editable"),e.setAttribute("contenteditable",!0),d.appendChild(c),d.appendChild(e),this.content.appendChild(d),d},h.prototype=new c,h.prototype.componentType="TextArea",h.prototype.init=function(a){this.constructor.prototype.init.call(this,a);var b=document.createElement("div");b.classList.add("full-width");var c=document.createElement("textarea");c.setAttribute("name",a),c.setAttribute("rows",5),c.classList.add("fl-editable"),c.classList.add("fl-text-area"),c.classList.add("form-control"),b.appendChild(c),this.content.appendChild(b),this.focusElement=c},h.prototype.setTitle=function(a){a&&this.title&&(this.title.innerText=a)},i.prototype=new c,i.prototype.componentType="TextBox",i.prototype.init=function(a){this.constructor.prototype.init.call(this,a);var b=document.createElement("div");b.classList.add("full-width");var c=document.createElement("input");c.setAttribute("type","text"),c.setAttribute("name",a),c.classList.add("fl-editable"),c.classList.add("fl-text-box"),c.classList.add("form-control"),b.appendChild(c),this.content.appendChild(b),this.focusElement=c},i.prototype.setLabel=function(a){a&&this.title&&(this.title.innerText=a)};var k=new b,l=new d(k.element);a.classList.add("fl-form-builder"),a.appendChild(l.element),a.appendChild(k.element)});
//# sourceMappingURL=fl-form-builder.map